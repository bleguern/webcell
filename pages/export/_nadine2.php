<?php
	include_once(dirname(__FILE__).'/../../util/sql.php');
	include_once(dirname(__FILE__).'/../../util/util.php');

function export_order_to_excel() {
	
	$xls_output = '<TABLE class="data" border=\'0\' name=\'stock\' cellpadding=\'3\' cellspacing=\'1\' =\'background-color:#d9d9d9\'>
						<TR>';
									
	$xls_output .= '<TD><b>Reference</b></TD>
					<TD><b>Description</b></TD>
					<TD><b>Stock</b></TD>
				</TR>';

	$sql = 'SELECT product.reference as reference, ' .
		   'product.name as name, ' .
		   'SUM(stock.quantity) as stock ' .
		   'FROM product ' .
		   'LEFT OUTER JOIN stock ON stock.product_id = product.id ' .
		   'WHERE product.reference IN (\'009532-20\', \'10454-20\', \'10457-20\', \'10458-20\', \'019938-20\', \'54001-20\', \'059034-20\', \'080157-20\', \'080257-20\', \'080857-20\', \'080957-20\', \'081057-20\', \'086057-20\', \'100140-20\', \'100142-04\', \'100143-08\', \'100145-11\', \'100146-13\', \'100160-20\', \'100162-04\', \'100163-08\', \'100164-09\', \'100165-11\', \'100166-13\', \'100167-15\', \'100170-20\', \'100183-08\', \'100187-15\', \'100188-10\', \'100201-17\', \'100210-20\', \'100220-20\', \'100221-17\', \'100241-17\', \'100250-20\', \'100310-17\', \'100311-20\', \'100320-20\', \'100330-17\', \'100340-20\', \'100350-17\', \'100360-20\', \'100400-20\', \'100401-17\', \'100420-20\', \'100421-17\', \'100440-20\', \'100441-17\', \'120360\', \'120460\', \'121316-20\', \'123639-20\', \'134539-20\', \'172136-20\', \'199549-20\', \'199835-20\', \'199840\', \'199940\', \'199950\', \'200340-20\', \'200529-17\', \'201370-20\', \'201379-17\', \'201390-20\', \'201510-20\', \'201519-17\', \'201530-20\', \'202020-20\', \'202029-17\', \'202050-20\', \'202059-17\', \'202070-20\', \'202079-17\', \'202089-17\', \'204039-20\', \'204059-17\', \'207271-17\', \'208040-17\', \'208605-20\', \'209676-17\', \'210340-20\', \'210520-20\', \'217274-17\', \'239838-40\', \'239970-20\', \'241601-20\', \'260080-20\', \'260289-20\', \'260393-20\', \'261590-20\', \'271156-20\', \'272056-20\', \'272139-20\', \'273053-20\', \'273116-20\', \'273139-20\', \'274072-20\', \'274077-20\', \'274509-20\', \'274546-20\', \'275001-20\', \'275006-20\', \'275020-20\', \'275028-20\', \'275032-20\', \'275033-20\', \'275036-20\', \'275039-20\', \'275041-20\', \'275056-20\', \'275064-20\', \'275078-20\', \'275098-20\', \'275113-20\', \'275206-20\', \'275233-20\', \'275533-20\', \'275540-20\', \'276003-20\', \'276013-20\', \'276018-20\', \'276028-20\', \'276031-20\', \'276032-20\', \'276033-20\', \'276036-20\', \'276041-20\', \'276044-20\', \'276048-20\', \'276062-20\', \'276077-20\', \'276096-20\', \'276098-20\', \'276100-20\', \'276114-20\', \'276118-20\', \'276139-20\', \'276141-20\', \'276172-20\', \'276177-20\', \'276208-20\', \'276236-20\', \'276241-20\', \'276244-20\', \'276256-20\', \'276272-20\', \'276344-20\', \'276404-20\', \'276433-20\', \'276504-20\', \'276513-20\', \'277846-20\', \'277905-20\', \'277906-20\', \'277908-20\', \'277977-20\', \'277978-20\', \'278090-20\', \'278100-20\', \'278101-20\', \'278119-20\', \'278163-20\', \'278203-20\', \'278219-20\', \'278348-20\', \'278364-20\', \'278390-20\', \'278816-20\', \'279036-20\', \'289911\', \'294904\', \'320062\', \'320100\', \'320102\', \'320124\', \'320161\', \'320164\', \'320222\', \'320260\', \'321038-40\', \'322142\', \'322144\', \'322170-20\', \'324180-20\', \'400442-20\', \'463056-20\', \'558512-20\', \'577422-20\', \'577741-20\', \'578741-20\', \'600495-20\', \'600522-20\', \'600622-20\', \'600722-20\', \'609322-20\', \'650416-20\', \'650516-20\', \'650517-20\', \'650616-20\', \'650716-20\', \'655616-20\', \'656818-20\', \'657616-20\', \'657618-20\', \'658616-20\', \'658617-20\', \'659016-20\', \'659416-20\', \'659417-20\', \'659716-20\', \'659717-20\', \'659718-20\', \'661601-20\', \'700415-20\', \'700515-20\', \'700527-20\', \'700575-20\', \'700615-20\', \'700627-20\', \'700675-20\', \'700715-20\', \'700727-20\', \'700775-20\', \'705612-20\', \'705675-20\', \'705695-20\', \'706015-20\', \'706027-20\', \'706052-20\', \'706091-20\', \'706823-20\', \'706826-20\', \'706853-20\', \'706891-20\', \'706915-20\', \'706927-20\', \'706975-20\', \'707624-20\', \'707626-20\', \'707636-20\', \'707651-20\', \'707677-20\', \'708315-20\', \'708327-20\', \'708352-20\', \'708512-20\', \'708554-20\', \'708609-20\', \'708612-20\', \'708623-20\', \'708624-20\', \'708626-20\', \'708636-20\', \'708651-20\', \'708653-20\', \'708654-20\', \'708675-20\', \'708677-20\', \'708678-20\', \'708691-20\', \'708695-20\', \'709009-20\', \'709012-20\', \'709015-20\', \'709023-20\', \'709024-20\', \'709027-20\', \'709052-20\', \'709075-20\', \'709077-20\', \'709091-20\', \'709709-20\', \'709712-20\', \'709723-20\', \'709724-20\', \'709726-20\', \'709736-20\', \'709751-20\', \'709753-20\', \'709754-20\', \'709775-20\', \'709777-20\', \'709778-20\', \'709791-20\', \'709795-20\', \'709827-20\', \'709927-20\', \'709952-20\', \'902076-20\', \'00903703-20\', \'970549\', \'01954550-20\', \'01993850-20\', \'09006922\', \'09180931\', \'09181931\', \'09194932\', \'10021003-20\', \'10023003-20\', \'10025003-20\', \'10040002-20\', \'10040004-20\', \'10040102-17\', \'10042002-20\', \'10042004-20\', \'10042102-17\', \'10044002-20\', \'10044004-20\', \'10044102-17\', \'12363950-20\', \'13353901-20\', \'19983560-20\', \'19984050\', \'19994050\', \'19995001\', \'20153008-20\', \'20993901-20\', \'21727450-17\', \'27640799-20\', \'32016101\', \'43006901\', \'43118501\', \'43118504\', \'43213901\', \'43225901\', \'43225903\', \'43645901\', \'45128901\', \'45128902\', \'54659501\', \'58859501\', \'62236502\', \'62236503\', \'66160150-20\', \'2013700202-20\', \'2015100202-20\', \'2096730050-17\', \'2399700150-20\', \'A45126902\', \'274950-20\', \'272950-20\', \'271140-20\', \'27095001-20\', \'271044-20\', \'271007-20\', \'270399-20\', \'271103-20\', \'271001-20\', \'271030-20\', \'271100-20\', \'271104-20\', \'271105-20\', \'271204-20\', \'271031-20\', \'272150-20\', \'272350-20\', \'271163-20\', \'271263-20\', \'27035001-20\', \'271062-20\', \'271120-20\', \'271233-20\', \'271213-20\', \'271133-20\', \'271098-20\', \'271113-20\', \'271198-20\', \'271096-20\', \'271077-20\', \'271078-20\', \'271177-20\', \'271539-20\', \'271072-20\', \'271053-20\', \'271639-20\', \'272450-20\', \'263298-20\', \'263680-20\', \'263780-20\', \'260481-20\', \'253285-20\', \'261380-20\', \'261281-20\', \'260685-20\', \'262180-20\', \'260885-20\', \'270885-20\', \'261480-20\', \'260181-20\', \'260381-20\', \'270485-20\', \'270385-20\', \'261080-20\', \'261785-20\', \'271380-20\', \'261181-20\', \'262881-20\', \'262280-20\', \'270181-20\', \'270483-20\', \'270383-20\', \'27375001-20\', \'27075001-20\', \'271118-20\', \'271018-20\', \'271028-20\', \'100200-20\', \'100141-17\', \'100147-15\', \'100148-10\', \'100150-20\', \'100161-17\', \'100168-10\', \'10023001-20\', \'100240-20\', \'100182-04\', \'100185-11\', \'100180-20\', \'100181-17\') ' .
		   'GROUP BY product.reference ' .
		   'ORDER BY product.reference';
	
	$result = mysql_select_query($sql);

	if($result) {

		while ($row = mysql_fetch_array($result, MYSQL_ASSOC)) {

			$xls_output .= '<TR =\'background-color:#ffffff\' valign=\'center\'>';
			
			$xls_output .= '<TD class="data">'.format_to_reference($row['reference']).'</TD>
							 <TD class="data">'.$row['name'].'</TD>
							 <TD class="data">'.$row['stock'].'</TD>
						   </TR>';
		}
	}

	$xls_output .= '</TABLE>';

	return $xls_output;
}


session_cache_limiter("must-revalidate");
header("Content-type: application/vnd.ms-excel");
header("Content-disposition: attachment; filename=stock_".date("Ymd").".xls");

session_start();

print export_order_to_excel();

exit();

?>